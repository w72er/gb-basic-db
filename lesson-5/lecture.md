# Операторы, фильтрация, сортировка и ограничение

План:
* Операторы
* Условная выборка
* Сортировка и ограничения
* Предопределенные функции. Часть 1.
* Предопределенные функции. Часть 2.

## Операторы

Конструкции языка для преобразования данных.
+ - * / % div:
```sql
SELECT 3 + 5;
-- переименовать столбец
SELECT 3 + 5 AS xxx;

UPDATE tbl SET id = id + 10;
```

Если  строка не может быть приведена к числу, то она будет 0
`select 'd' + 'd'; -- 0`

Деление на 0 не вызывает падение, и получим null.
DIV - целочисленное деление, просто отбрасывается.
/ - деление с дробью
% - остаток от деления (mod - альтернатива)

Логический тип

Как и serial TRUE and FALSE - константы на tinyint = 1 and 0.
<=> безопасное стравнение с NULL (НЛО)
SELECT 2>3; -- 0
SELECT 2<3; -- 1
SELECT 2!=3, 2<>3 -- 1 1
SELECT NOT TRUE; -- 
сравнение с нулл всегда нул
2<=>null -- 0
null<=>null -- 1
is null, is not null - альтернатива

Логическое AND OR
```text
create table tbl (
 x int
 y int
 sum int as (x+y) -- вычисляется каждый раз
                  -- добавив в конец STORED поле будет храниться и даже можно по нему индексировать.
);
```

## Условная выборка

БД хранят миллионы записей, поэтому изменить строку - встречается довольно часто.

WHERE id > 2 and id <=4
WHERE id [NOT] BETWEEN 3 AND 4

WHERE id IN (1,2,5);

Если в списке null, то вернется null
2 IN ( 0, NULL ) -- null

WHERE id NOT in ();

LIKE позволяет использовать шаблон.
Преимущество над равно
%- любой символ и может находится везде в слове.,
_ - один '___' - любое слово из трех символов.

SELECT * FROM catalogs WHERE name LIKE '%ы';
При использовании LIKE столбец приводится к строке.

Регулярные выражения.

Более медленное выполение, зато гибкие.

RLIKE 'грам';
^ - начало строки. $ - конец строки.
| - альтернативы или логическое или.
RLIKE 'abc|abd'
[abc] есть ли любой символ в диапазоне
'r' RLIKE '[а-яё]' ё не в диапазоне
классы символов 7 [[:digit]]

Квантификаторы
? - вхождение символа
* - любое 
+ - 1 или более
    
Фигурные скобки - сколько раз символ должен входить в регулярное выражение.

## Сортировка и ограничения

Запрос выдает в порядке в котором они хранятся в базе. По мере удаления или обносления, порядок изменяется.
ORDER BY столбец, по которым сортируем данные.
SELECT * FROM catalogs ORDER BY name;

Предположим что цена должна быть отсортирована сначала по каталогу, а затем цене в каталоге.
SELECT id, catalog_id, price, name FROM products ORDER BY catalog_id, price;
Изменить порядок сортировки можем с помощью DESC;
SELECT id, catalog_id, price, name FROM products ORDER BY catalog_id DESC, price DESC;

Результат выборки может содержать тысячи записей, поэтому информацию представляют постранично. Обычно
пользователю хочется получить всего несколько записей. LIMIT

Вывод уникальных значений.

SELECT DISTINCT catalog_id FROM .. ORDER BY ..;

Уменьшим цену материнских плат на 10%, при этом только тех чья цена превышает 5000
select * from tbl where catalog_id = 2 and price > 5000;
UPDATE products SET price = 0.9 * price WHERE catalog_id = 2 and price > 5000;

Давайте удалим две самые дорогие позиции в products.
SELECT * FROM products ORDER BY price DESC LIMIT 2;
DELETE FROM products ORDER BY price DESC LIMIT 2;

## Предопределенные функции MYSQL

NOW() в рамках одного значения одно

DATE(NOW()) - приведение к дате.

[AS] можно опустить

DATE_FORMAT

UNIXSTAMP.




